/**
 * Generates item-images.generated.ts from data/images/items/*.png
 * Run from project root: node data/scripts/build-item-images.js
 *
 * 1) Copies each .png into assets/images/items/ so Metro/Expo can resolve them.
 * 2) Writes item-images.generated.ts at project root with require('./assets/images/items/...').
 *
 * Each image is mapped by filename (without .png) for id/slug matching.
 */

const fs = require('fs');
const path = require('path');

const IMAGES_DIR = path.join(__dirname, '..', 'images', 'items');
const ASSETS_ITEMS = path.join(__dirname, '..', '..', 'assets', 'images', 'items');
const OUT_FILE = path.join(__dirname, '..', '..', 'item-images.generated.ts');

fs.mkdirSync(ASSETS_ITEMS, { recursive: true });

const files = fs.readdirSync(IMAGES_DIR).filter((f) => f.toLowerCase().endsWith('.png'));
const lines = [
  '// Auto-generated by data/scripts/build-item-images.js â€” do not edit by hand',
  '',
  'export const ITEM_IMAGES: Record<string, unknown> = {',
];

for (const f of files.sort()) {
  const key = f.replace(/\.png$/i, '');
  if (!/^[a-z0-9_]+$/i.test(key)) continue;
  fs.copyFileSync(path.join(IMAGES_DIR, f), path.join(ASSETS_ITEMS, f));
  lines.push(`  '${key}': require('./assets/images/items/${key}.png'),`);
}

lines.push('};');
lines.push('');
fs.writeFileSync(OUT_FILE, lines.join('\n'), 'utf8');
console.log('Copied', files.length, 'images to assets/images/items/');
console.log('Wrote', OUT_FILE);
